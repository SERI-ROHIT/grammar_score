import librosa
import noisereduce as nr
import re

# kaggle dataset

audio_path = "download_mp3.mp3"

audio, sr = librosa.load(audio_path, sr=16000)
print("Sample Rate:", sr)
print("Audio Length (seconds):", len(audio)/sr)



clean_audio = nr.reduce_noise(y=audio, sr=sr)


#convert speech to text

import whisper

model = whisper.load_model("base")
result = model.transcribe("download_mp3.mp3")

transcribed_text = result["text"]
print(transcribed_text)

# text preprocessing

text = transcribed_text.lower()
text = re.sub(r"\b(uh|um|ah|hmm)\b", "", text)
text = text.strip()

print(text)

# grammar error detection

import language_tool_python

tool = language_tool_python.LanguageTool('en-US')
matches = tool.check(text)

grammar_errors = len(matches)
print("Number of Grammar Errors:", grammar_errors)

for m in matches[:3]:
    print(m.message)

#extract additinal grammer feature

import textstat

word_count = len(text.split())
readability = textstat.flesch_reading_ease(text)

features = {
    "word_count": word_count,
    "grammar_errors": grammar_errors,
    "readability": readability
}

features


# grammer scoring logic

score = max(
    1,
    5 - (grammar_errors * 0.8) + (readability / 100)
)


# machine learning model

from sklearn.ensemble import RandomForestRegressor

model = RandomForestRegressor()
model.fit(X_train, y_train)
prediction = model.predict(X_test)

